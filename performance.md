# 19.8.6

자바스크립트 성능 최적화 전략 

1. 히든클래스

자바스크립트 인터프리터 (실행하면서 해석한다.)는 해쉬함수구조로 객체 속성값 위치를 메모리에 저장함. 다른언어는 같은 데이터는 같은 주소에 저장된다. 하지만.. 자바스크립트는... 그렇지 않다.

- 이름 = 홍길동
- 나이 = 100
- 생일 = 1988

위의 값에서 홍길동과 100 1988이라는 값의 위치를 이름 나이 생일에 저장하는 것이라고 보면 된다. 그러면 속성을 가져오는게 되는 비용이 해쉬를 사용하는 만큼 더 많아지게 된다. 핵심은 그래서 해쉬, 저장하는 위치를 최적화 하는 것이다. 이런 방법으로 해결하는 것이 히든 클래스다. 최대한 같은 데이터는 같은 주소를 갖게 작업하자.


2. 인라인 캐싱

최근 호출된 함수에 파라미터로 전달된 타입을 캐싱한다. 이렇게 하면 불필요한 추론을 통한 비용이 들지 않는다.

2번의 성공적인 호출이 알어난다면, 조회한 속성에 대한 오프셋 포린터를 더해놓음으로(표시한다) 불필요한 추론에 비용을 쏟지 않는 것이다.

엔진에서 타입 전환시 인터프리터 단게에서 불필요한 추론이 필요해진다. 그러므로 원시형 타입만큼은 타입변환을 하지않고 지속적으로 쓰는것이 좋다.

배열또한 마찬가지다. 리스트 유형이 변하여 불필요하게 (크랭크샤프트) 리소스를 사용하지 말자.


3. 그럼 어떻게 ?

- 객체의 속성을 같은 순서로 초기화 같은 속성을 같는 객체는 같은 주소를 바라보게 하는 것이다.

- 함수를 실행해야 한다면 같은 메소드가 반복적으로 실행될수 있게 한다.






# 19.8.9

## 렌더링
브라우저에서 메모리를 사용하는데 렌더링 트리를 레이아웃 시키는데 드는 비용이다. 이런 리플로우, 리패인터를 최소화 시키는 것이 속도향상을 시키는 방법중 하나다. 
애니메이션의 경우 리페인터 리플로우의 지속적인 갱신으로 이뤄지기 때문에 적절한 분배로 효과적인 애니메이션을 구현해야 메모리 사용을 줄일 수 있다.
물론 최근 브라우저 엔진등이 매우 스마트해져서 리플로우, 리페인터작업이 산발적으로 되있어도 한번에 처리해주기는 하지만 그렇지 못한 경우도 있다. 

강제 레이아웃 리플로우다. 이경우는 엘리먼트의 박스메트릭스 스크롤, 포커스 등이 있는데 내가 이런 속성을 기억하지 못할 거라면 이런 리플로우와 리페인터가 병목현상이 이뤄지지 않게 코드를 신중하게 짜야할 필요가 있다.

다른 방법으로 css을 사용해 자바스크립트 메인스레드가 연산을 하지 않게 해주는 것이다. 하지만 마찬가지로 css를 사용하더라도 브라우저가 리플러우 리페인터를 하는것은 어쩔수 없는 일이다. 이런 문제로 대부분의 css 속성이 이런 문제를 가지고 있지만 gpu를 사용하는 대체 속성을 이용해서 문제를 해결해도 나쁘지 않다.

그리고 레이아웃의 복잡성은 성능에 문제를 야기한다 왜냐면 그만큼 레아아웃을 다시 적용하는데 브라우저가 많은 연산을 해야 하기 때문이다.

리액트는 이런 문제를 해결하고자 돔의 업데이트를 최소화 하려 했고, 가상의 돔을 만들어 데이터를 변경하고 최종적인 변경된 돔을 실제 돔에 주입 시켜서 한정된 부분만 업데이트 되고 업데이트 주기또한 최소화 시켰다.


## 로딩 시간줄이기 

asset파일(svg, image, video, 등)을 받아오는 서버와 html,css,js 페이지 기본 구성요소를 받아오는 서버를 병렬로 요청함으로써 페이지 요청 응답 시간을 줄인다. 파일 및 데이터 gzip으로 사용하기, expire로 캐쉬 기간 늘리기 gzip을 사용하면 요청과정 파일의 사이즈가 현저하게 줄어 요청 시간이 단출 될 수 있다. 무조건적으로 쓰진 말고, 적절하게 요청에 대한 응답 데이타가 큼으로써 드는 비용이 브라우저에서 압축을 푸는데 드는 시간보다 더 많아 시간을 절약할수 있다고 파단될때만 쓰는 것이 좋다. 또한 한번에 요청하는 패킷이 다양하고 연속적이라면 http header 설정에서 connect설정에서 keepalive로 값을 바꿔져서 서버와 클라의 연결이 끊어지지 않게해 연결 해제의 불필요한 과정이 없게 하면 좋다. 페이지를 렌더링 하는 과정이 끝낫다면 연결을 끈어준다.